# https://crawl.kelbi.org/crawl/rcfiles/crawl-git/Nomi.rc
# my current default settings
name = Erin

# to make u stop being bad
autofight_stop = 80
autofight_caught = true
explore_delay = 20
explore_wall_bias = 0
show_more = false
auto_butcher = true

# general settings
trap_item_highlight = reverse
autopickup_search = true 
default_manual_training = true
show_more = false
travel_open_doors = false

# item slots
item_slot += identify:r
item_slot += stones:e
item_slot += poisoned dart:f
item_slot += boomerang of dispersal:i
item_slot += boomerang:g
item_slot += javelin:h

# messages, show more, etc 
force_more_message += floating eye
force_more_message += Ouch! That really hurt!
force_more_message += flesh start
force_more_message += very hungry
force_more_message += calcifying dust hits
force_more_message += Space warps horribly around you
force_more_message += your body is wracked
#force_more_message += You feel yourself slow down
force_more_message += hits you.*distortion
force_more_message += Space bends around you
force_more_message += fumble
force_more_message += wearing a (* shield|buckler)
force_more_message += A sentinel's mark forms upon you


ood_interesting = 8
note_hp_percent = 10
note_skill_levels = 1,5,10,15,27
note_items    = experience, acquirement, tremorstones, vane, running, of Zot, scarf of resistance
note_messages = You pass through the gate
note_messages = cast .* Abyss
note_messages = Your scales start
note_messages = protects you from harm
note_messages = shaft
note_monsters = orb of fire, ancient lich, Sigmund, Grinder, Maggie, Rupert, Louise, catoblepas, hydra

: if you.god() == "Jiyva" then
ignore = Jiyva gurgles merrily
ignore = Jiyva appreciates your sacrifice
ignore = Jiyva says: Divide and consume
ignore = You hear.*splatter
ignore = Jiyva alters your body
: end

# autopickups
ae := autopickup_exceptions
#ae += scrolls? of (vulnerability|amnesia|enchant|brand)
ae += atropa
ae += datura
ae += <throwing net
ae += <curare
ae += <vane
ae += <phial
ae += <lightning rod
ae += <box of beasts
ae += <tin of tremor
ae += <phantom mirror
#ae += <immolation
ae += <boomerang

: if (you.race() == "Orge" or you.race() == "Troll") then
ae += <large rock
: end

: if (you.race() == "Ogre" or you.race() == "Troll" or you.god() == "Trog") then
ae += <stone
ae += <javelin
ae += <dart
ae += <atropa
ae += <datura
: end

: if you.god() == "Trog" then
ae += rings of magical power
ae += rings of intelligence
ae += potions? of (magic|brilliance)
ae += scrolls? of (vulnerability|amnesia)
ae += amulets of magic regeneration
: end

# Character Stuff

# Combos i like
# combo = MiBe . hand axe, Gnoll Fighter . war axe, Spriggan Hunter, DjFe, Troll Gladiator . claws, GrEe, HoCa . hand axe, OgAM, DgTm, VSFi . trident
# combo = MiBe . hand axe, Gnoll Fighter . war axe, DjFe, Troll Gladiator . claws, HoCa . hand axe, OgAM, VSFi . trident

# uncomment for random random random
# OPTION = species:gnoll, background:wanderer

# uncomment for random "good" character
# OPTION = background:random, species:viable, weapon:viable

# edit for specific character
#species = Troll
#background = Gladiator
#weapon = claws

# functions

<
  function ready()
    AnnounceDamage()
  end
>

###############
# Damage Calc #
###############
<
  local previous_hp = 0
  local previous_mp = 0
  local previous_form = ""
  local was_berserk_last_turn = false
 
  function AnnounceDamage()
    local current_hp, max_hp = you.hp()
    local current_mp, max_mp = you.mp()
    --Things that increase hp/mp temporarily really mess with this
    local current_form = you.transform()
    local you_are_berserk = you.berserk()
    local max_hp_increased = false
    local max_hp_decreased = false

    if (current_form ~= previous_form) then
      if (previous_form:find("dragon") or 
          previous_form:find("statue") or
          previous_form:find("tree") or
          previous_form:find("ice")) then
        max_hp_decreased = true
      elseif (current_form:find("dragon") or 
          current_form:find("statue") or
          current_form:find("tree") or
          current_form:find("ice")) then
        max_hp_increased = true
      end
    end
    if (was_berserk_last_turn and not you_are_berserk) then
      max_hp_decreased = true
    elseif (you_are_berserk and not was_berserk_last_turn) then
      max_hp_increased = true
    end
    
    --crawl.mpr(string.format("previous_form is: %s", previous_form))
    --crawl.mpr(string.format("current_form is: %s", current_form))
    --crawl.mpr(string.format("max_hp_increased is: %s", max_hp_increased and "True" or "False"))
    --crawl.mpr(string.format("max_hp_decreased is: %s", max_hp_decreased and "True" or "False"))
    
    --crawl.mpr(string:format("you_are_berserk is: %s", you_are_berserk and "True" or "False"))
    --crawl.mpr(string:format("was_berserk_last_turn is: %s", was_berserk_last_turn and "True" or "False"))
    
    
    --Skips message on initializing game
    if previous_hp > 0 then
      local hp_difference = previous_hp - current_hp
      local mp_difference = previous_mp - current_mp
      
      if max_hp_increased or max_hp_decreased then
        if max_hp_increased then 
          crawl.mpr("<green>(" .. current_hp .. "/" .. max_hp .. ")</green>")
        else
          crawl.mpr("<yellow>(" .. current_hp .. "/" .. max_hp .. " )</yellow>")
        end
      else
        --On losing health
        if (current_hp < previous_hp) then
          if current_hp <= (max_hp * 0.30) then
            crawl.mpr("<red>You take " .. hp_difference .. " damage </red><lightred> (" .. current_hp .. "/" .. max_hp .. ")</lightred>")
          elseif current_hp <= (max_hp * 0.50) then
            crawl.mpr("<red>You take " .. hp_difference .. " damage (" .. current_hp .. "/" .. max_hp .. ")</red>")
          elseif current_hp <= (max_hp *  0.70) then
            crawl.mpr("<red>You take " .. hp_difference .. " damage </red><yellow> (" .. current_hp .. "/" .. max_hp .. ")</yellow>")
          elseif current_hp <= (max_hp * 0.90) then
            crawl.mpr("<red>You take " .. hp_difference .. " damage </red><lightgrey>(" .. current_hp .. "/" .. max_hp .. ")</lightgrey>")
          else
            crawl.mpr("<red>You take " .. hp_difference .. " damage </red><green> (" .. current_hp .. "/" .. max_hp .. ")</green>")
          end
          if hp_difference > (max_hp * 0.20) then
            crawl.mpr("<lightred>Ouch! That really hurt!</lightred>")
          end
        end
  
        --On gaining more than 1 health
        if (current_hp > previous_hp) then
          --Removes the negative sign
          local health_inturn = (0 - hp_difference)
          if (health_inturn > 1) and not (current_hp == max_hp) then
            if current_hp <= (max_hp * 0.30) then
              crawl.mpr("<green>You recover " .. health_inturn .. " health</green><lightred> (" .. current_hp .. "/" .. max_hp .. ")</lightred>")
            elseif current_hp <= (max_hp * 0.50) then
              crawl.mpr("<green>You recover " .. health_inturn .. " health</green><red> (" .. current_hp .. "/" .. max_hp .. ")</red>")
            elseif current_hp <= (max_hp *  0.70) then
              crawl.mpr("<green>You recover " .. health_inturn .. " health</green><yellow> (" .. current_hp .. "/" .. max_hp .. ")</yellow>")
            elseif current_hp <= (max_hp * 0.90) then
              crawl.mpr("<green>You recover " .. health_inturn .. " health</green><lightgrey> (" .. current_hp .. "/" .. max_hp .. ")</lightgrey>")
            else
              crawl.mpr("<green>You recover " .. health_inturn .. " health (" .. current_hp .. "/" .. max_hp .. ")</green>")
            end
          end
        end
 
        --On gaining more than 1 magic
        if (current_mp > previous_mp) then
          --Removes the negative sign
          local mp_inturn = (0 - mp_difference)
          if (mp_inturn > 1) and not (current_mp == max_mp) then
            if current_mp < (max_mp * 0.25) then 
              crawl.mpr("<lightcyan>You regain " .. mp_inturn .. " magic</lightcyan><red> (" .. current_mp .. "/" .. max_mp .. ")</red>")
            elseif current_mp < (max_mp * 0.50) then 
              crawl.mpr("<lightcyan>You regain " .. mp_inturn .. " magic</lightcyan><yellow> (" .. current_mp .. "/" .. max_mp .. ")</yellow>")            
            else
              crawl.mpr("<lightcyan>You regain " .. mp_inturn .. " magic</lightcyan><green> (" .. current_mp .. "/" .. max_mp .. ")</green>")
            end
          end
        end
  
        --On losing magic
        if current_mp < previous_mp then
          if current_mp <= (max_mp / 5) then
            crawl.mpr("<lightcyan>You now have </lightcyan><red>" .. current_mp .. "/" ..max_mp .." magic.</red>")      
          elseif current_mp <= (max_mp / 2) then
            crawl.mpr("<lightcyan>You now have </lightcyan><yellow>" .. current_mp .. "/" ..max_mp .." magic.</yellow>")
          else
            crawl.mpr("<lightcyan>You now have </lightcyan><green>" .. current_mp .. "/" ..max_mp .." magic.</green>")
          end
        end
      end
    end
    
    --Set previous hp/mp and form at end of turn
    previous_hp = current_hp
    previous_mp = current_mp
    previous_form = current_form
    was_berserk_last_turn = you_are_berserk
end
>

