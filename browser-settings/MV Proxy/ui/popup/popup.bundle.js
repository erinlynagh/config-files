/*! For license information please see popup.bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t={904:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var o=[],i=new MessageChannel,a=function(){this.postMessage(void 0)}.bind(i.port2);i.port1.onmessage=function(){var e=o;o=[];for(var t=performance.now(),n=0;n<e.length;n++)e[n](t)},i=null;const r=function(e){1===o.push(e)&&requestAnimationFrame(a)}},291:(e,t,n)=>{n.r(t),n.d(t,{createFocusTrap:()=>_});var o=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],i=o.join(","),a="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,r=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?function(e){return"true"===e.contentEditable}(e)?0:"AUDIO"!==e.nodeName&&"VIDEO"!==e.nodeName&&"DETAILS"!==e.nodeName||null!==e.getAttribute("tabindex")?e.tabIndex:0:t},s=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},l=function(e){return"INPUT"===e.tagName},c=function(e,t){return!(t.disabled||function(e){return l(e)&&"hidden"===e.type}(t)||function(e,t){if("hidden"===getComputedStyle(e).visibility)return!0;var n=a.call(e,"details>summary:first-of-type")?e.parentElement:e;if(a.call(n,"details:not([open]) *"))return!0;if(t&&"full"!==t){if("non-zero-area"===t){var o=e.getBoundingClientRect(),i=o.width,r=o.height;return 0===i&&0===r}}else for(;e;){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(t,e.displayCheck)||function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some((function(e){return"SUMMARY"===e.tagName}))}(t)||function(e){if(l(e)||"SELECT"===e.tagName||"TEXTAREA"===e.tagName||"BUTTON"===e.tagName)for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var n=0;n<t.children.length;n++){var o=t.children.item(n);if("LEGEND"===o.tagName)return!o.contains(e)}return!0}t=t.parentElement}return!1}(t))},u=function(e,t){return!(!c(e,t)||function(e){return function(e){return l(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t,n=e.form||e.ownerDocument,o=function(e){return n.querySelectorAll('input[type="radio"][name="'+e+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)t=o(window.CSS.escape(e.name));else try{t=o(e.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",e.message),!1}var i=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]}(t,e.form);return!i||i===e}(e)}(t)||r(t)<0)},d=o.concat("iframe").join(","),p=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return!1!==a.call(e,d)&&c(t,e)};function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v,m=(v=[],{activateTrap:function(e){if(v.length>0){var t=v[v.length-1];t!==e&&t.pause()}var n=v.indexOf(e);-1===n||v.splice(n,1),v.push(e)},deactivateTrap:function(e){var t=v.indexOf(e);-1!==t&&v.splice(t,1),v.length>0&&v[v.length-1].unpause()}}),b=function(e){return setTimeout(e,0)},y=function(e,t){var n=-1;return e.every((function(e,o){return!t(e)||(n=o,!1)})),n},g=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return"function"==typeof e?e.apply(void 0,n):e},_=function(e,t){var n,o=document,l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},t),c={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},d=function(e,t,n){return e&&void 0!==e[t]?e[t]:l[n||t]},v=function(e){return c.containers.some((function(t){return t.contains(e)}))},_=function(e){var t=l[e];if(!t)return null;var n=t;if("string"==typeof t&&!(n=o.querySelector(t)))throw new Error("`".concat(e,"` refers to no known node"));if("function"==typeof t&&!(n=t()))throw new Error("`".concat(e,"` did not return a node"));return n},E=function(){var e;if(!1===d({},"initialFocus"))return!1;if(null!==_("initialFocus"))e=_("initialFocus");else if(v(o.activeElement))e=o.activeElement;else{var t=c.tabbableGroups[0];e=t&&t.firstTabbableNode||_("fallbackFocus")}if(!e)throw new Error("Your focus-trap needs to have at least one focusable element");return e},C=function(){if(c.tabbableGroups=c.containers.map((function(e){var t,n,o,l,c,d,p,f=(n=[],o=[],(l=e,c=(t=t||{}).includeContainer,d=u.bind(null,t),p=Array.prototype.slice.apply(l.querySelectorAll(i)),c&&a.call(l,i)&&p.unshift(l),p.filter(d)).forEach((function(e,t){var i=r(e);0===i?n.push(e):o.push({documentOrder:t,tabIndex:i,node:e})})),o.sort(s).map((function(e){return e.node})).concat(n));if(f.length>0)return{container:e,firstTabbableNode:f[0],lastTabbableNode:f[f.length-1]}})).filter((function(e){return!!e})),c.tabbableGroups.length<=0&&!_("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},S=function e(t){!1!==t&&t!==o.activeElement&&(t&&t.focus?(t.focus({preventScroll:!!l.preventScroll}),c.mostRecentlyFocusedNode=t,function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(t)&&t.select()):e(E()))},w=function(e){return _("setReturnFocus")||e},O=function(e){v(e.target)||(g(l.clickOutsideDeactivates,e)?n.deactivate({returnFocus:l.returnFocusOnDeactivate&&!p(e.target)}):g(l.allowOutsideClick,e)||e.preventDefault())},k=function(e){var t=v(e.target);t||e.target instanceof Document?t&&(c.mostRecentlyFocusedNode=e.target):(e.stopImmediatePropagation(),S(c.mostRecentlyFocusedNode||E()))},N=function(e){if(function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode}(e)&&!1!==g(l.escapeDeactivates))return e.preventDefault(),void n.deactivate();(function(e){return"Tab"===e.key||9===e.keyCode})(e)&&function(e){C();var t=null;if(c.tabbableGroups.length>0){var n=y(c.tabbableGroups,(function(t){return t.container.contains(e.target)}));if(n<0)t=e.shiftKey?c.tabbableGroups[c.tabbableGroups.length-1].lastTabbableNode:c.tabbableGroups[0].firstTabbableNode;else if(e.shiftKey){var o=y(c.tabbableGroups,(function(t){var n=t.firstTabbableNode;return e.target===n}));if(o<0&&c.tabbableGroups[n].container===e.target&&(o=n),o>=0){var i=0===o?c.tabbableGroups.length-1:o-1;t=c.tabbableGroups[i].lastTabbableNode}}else{var a=y(c.tabbableGroups,(function(t){var n=t.lastTabbableNode;return e.target===n}));if(a<0&&c.tabbableGroups[n].container===e.target&&(a=n),a>=0){var r=a===c.tabbableGroups.length-1?0:a+1;t=c.tabbableGroups[r].firstTabbableNode}}}else t=_("fallbackFocus");t&&(e.preventDefault(),S(t))}(e)},x=function(e){g(l.clickOutsideDeactivates,e)||v(e.target)||g(l.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},D=function(){if(c.active)return m.activateTrap(n),c.delayInitialFocusTimer=l.delayInitialFocus?b((function(){S(E())})):S(E()),o.addEventListener("focusin",k,!0),o.addEventListener("mousedown",O,{capture:!0,passive:!1}),o.addEventListener("touchstart",O,{capture:!0,passive:!1}),o.addEventListener("click",x,{capture:!0,passive:!1}),o.addEventListener("keydown",N,{capture:!0,passive:!1}),n},L=function(){if(c.active)return o.removeEventListener("focusin",k,!0),o.removeEventListener("mousedown",O,!0),o.removeEventListener("touchstart",O,!0),o.removeEventListener("click",x,!0),o.removeEventListener("keydown",N,!0),n};return(n={activate:function(e){if(c.active)return this;var t=d(e,"onActivate"),n=d(e,"onPostActivate"),i=d(e,"checkCanFocusTrap");i||C(),c.active=!0,c.paused=!1,c.nodeFocusedBeforeActivation=o.activeElement,t&&t();var a=function(){i&&C(),D(),n&&n()};return i?(i(c.containers.concat()).then(a,a),this):(a(),this)},deactivate:function(e){if(!c.active)return this;clearTimeout(c.delayInitialFocusTimer),c.delayInitialFocusTimer=void 0,L(),c.active=!1,c.paused=!1,m.deactivateTrap(n);var t=d(e,"onDeactivate"),o=d(e,"onPostDeactivate"),i=d(e,"checkCanReturnFocus");t&&t();var a=d(e,"returnFocus","returnFocusOnDeactivate"),r=function(){b((function(){a&&S(w(c.nodeFocusedBeforeActivation)),o&&o()}))};return a&&i?(i(w(c.nodeFocusedBeforeActivation)).then(r,r),this):(r(),this)},pause:function(){return c.paused||!c.active||(c.paused=!0,L()),this},unpause:function(){return c.paused&&c.active?(c.paused=!1,C(),D(),this):this},updateContainerElements:function(e){var t=[].concat(e).filter(Boolean);return c.containers=t.map((function(e){return"string"==typeof e?o.querySelector(e):e})),c.active&&C(),this}}).updateContainerElements(e),n}},970:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={autoConnect:!1,rememberConnectedServer:!1,proxyDns:!0,enableNotifications:!0,enableIpv6Lookups:!1,enableNotificationsOnlyErrors:!1,enableDebugInfo:!1,enableExcludeList:!1,excludeList:[]}},922:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.onConnect={addListener(e){browser.runtime.onConnect.addListener(e)},removeListener(e){browser.runtime.onConnect.removeListener(e)},hasListener:e=>browser.runtime.onConnect.hasListener(e)}}connect(e){return browser.runtime.connect(e)}connectTab(e,t){return browser.tabs.connect(e,t)}}},627:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TypedEventTarget=void 0;class n extends EventTarget{addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}dispatchEvent(e){return super.dispatchEvent(e)}}t.TypedEventTarget=n},850:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TypedStorageArea=void 0,t.TypedStorageArea=class{constructor(e){this.storageArea=e}get(e){return n(this,void 0,void 0,(function*(){return yield this.storageArea.get(e)}))}getBytesInUse(e){return n(this,void 0,void 0,(function*(){return yield this.storageArea.getBytesInUse(e)}))}set(e){return n(this,void 0,void 0,(function*(){yield this.storageArea.set(e)}))}remove(e){return n(this,void 0,void 0,(function*(){yield this.storageArea.remove(e)}))}clear(){return n(this,void 0,void 0,(function*(){yield this.storageArea.clear()}))}}},541:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;class n{constructor(e){this.prefix=e}log(e,t){const n=`${this.prefix} (Log): ${e}`;t?console.log(n,t):console.log(n)}info(e,t){const n=`${this.prefix} (Info): ${e}`;t?console.info(n,t):console.info(n)}error(e,t){const n=`${this.prefix} (Error): ${e}`;return t?console.error(n,t):console.error(n),new Error(n)}}t.Logger=n,t.default=new n("mullvad")},662:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getServerIdFromHost=t.fetchServerList=t.fetchPortDetails=t.fetchConnectionDetails=t.fetchIpAddress=t.CHECK_URL=t.getShortSocksName=t.getFullSocksHost=t.SOCKS_PORT=t.SOCKS_ADDRESS_WG=t.SOCKS_ADDRESS=t.EndpointVariant=void 0;const i=new(n(541).Logger)("mullvadApi"),a="am.i.mullvad.net",r=`https://${a}`,s=`https://ipv4.${a}`,l=`https://ipv6.${a}`;var c;function u(e){let t;switch(e){case c.IPv4:t=s;break;case c.IPv6:t=l;break;default:throw new Error("Invalid endpoint variant")}return{endpointAimIp:`${t}/ip`,endpointAimDetails:`${t}/json`}}!function(e){e[e.IPv4=0]="IPv4",e[e.IPv6=1]="IPv6"}(c=t.EndpointVariant||(t.EndpointVariant={}));const d=`${r}/port`;t.SOCKS_ADDRESS="10.8.0.1",t.SOCKS_ADDRESS_WG="10.64.0.1",t.SOCKS_PORT="1080",t.getFullSocksHost=function(e){return e.endsWith("mullvad.net")?e:`${e}.mullvad.net`},t.getShortSocksName=function(e){return e.endsWith(".socks5.relays.mullvad.net")?e.slice(0,-26):e},t.CHECK_URL="https://mullvad.net/check",t.fetchIpAddress=function(e=c.IPv4,t){return o(this,void 0,void 0,(function*(){i.info("Fetching IP address...");const{endpointAimIp:n}=u(e),o=yield fetch(n,t);return(yield o.text()).trim()}))},t.fetchConnectionDetails=function(e=c.IPv4,t){var n;return o(this,void 0,void 0,(function*(){i.info("Fetching connection details...");const{endpointAimDetails:o}=u(e),a=yield fetch(o,t),r=yield a.json();return r.mullvad_server_type=null===(n=r.mullvad_server_type)||void 0===n?void 0:n.toLowerCase(),r}))},t.fetchPortDetails=function(e,t){return o(this,void 0,void 0,(function*(){if(e<1||e>65536)throw new Error("Invalid port!");let n;i.info("Fetching port details...");try{const o=yield fetch(`${d}/${e}`,t);n=yield o.json()}catch(e){throw i.error("Failed to fetch port details",e)}return n}))},t.fetchServerList=function(e){return o(this,void 0,void 0,(function*(){let t;i.info("Fetching server list...");try{const n=yield fetch("https://api.mullvad.net/www/relays/wireguard/",e);t=yield n.json()}catch(e){throw i.error("Failed to fetch server list",e)}return t}))},t.getServerIdFromHost=function(e){return parseInt(e.slice(2,e.indexOf("-")))}},748:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(970)),r=i(n(541)),s=n(627),l=new(n(850).TypedStorageArea)(browser.storage.sync);t.default=new class extends s.TypedEventTarget{constructor(){super(),this.onStorageChanged=this.onStorageChanged.bind(this),browser.storage.onChanged.addListener(this.onStorageChanged),window.addEventListener("unload",(()=>{browser.storage.onChanged.removeListener(this.onStorageChanged)}))}onStorageChanged(e,t){if("sync"===t&&"options"in e){const{oldValue:t,newValue:n}=e.options,o=[];for(const e of Object.keys(n)){if(t){if(!(e in t))continue;const o=t[e],i=n[e];if(o===i)continue;if(o instanceof Array&&i instanceof Array&&o.length===i.length&&o.every(((e,t)=>e===i[t])))continue}o.push(e)}this.dispatchEvent(new CustomEvent("changed",{detail:o}))}}getAll(){return o(this,void 0,void 0,(function*(){const{options:e}=yield l.get("options");return e}))}setAll(e=a.default){return o(this,void 0,void 0,(function*(){return l.set({options:e})}))}get(e){return o(this,void 0,void 0,(function*(){const t=yield this.getAll();if(t.hasOwnProperty(e))return t[e];throw r.default.error(`Failed to find option ${e} in storage.`)}))}set(e,t){return o(this,void 0,void 0,(function*(){const n=yield this.getAll();return n[e]=t,this.setAll(n)}))}update(e=a.default){return o(this,void 0,void 0,(function*(){const t=yield this.getAll();t||this.setAll();for(const[n,o]of Object.entries(e))t.hasOwnProperty(n)||(t[n]=o);return this.setAll(t)}))}}},721:function(e,t){var n,o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getMinutesInMs=t.getBrowserType=t.BrowserType=void 0,function(e){e[e.Chromium=0]="Chromium",e[e.Firefox=1]="Firefox",e[e.Unknown=2]="Unknown"}(n=t.BrowserType||(t.BrowserType={})),t.getBrowserType=function(){return o(this,void 0,void 0,(function*(){const e=browser.runtime.getBrowserInfo;return e?"firefox"===(yield e()).name.toLowerCase()?n.Firefox:n.Unknown:n.Chromium}))},t.getMinutesInMs=function(e){return 60*e*1e3}},876:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(850);t.default=new o.TypedStorageArea(browser.storage.local)},740:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(922));t.default=new i.default},454:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsView=void 0;const l=s(n(776)),c=s(n(748)),u=a(n(721)),d=s(n(876)),p=browser.i18n.getMessage;class f extends l.default.Component{constructor(e){super(e),this.state={browserType:u.BrowserType.Unknown},this.handleInputChange=this.handleInputChange.bind(this),this.handleExcludeListChange=this.handleExcludeListChange.bind(this),this.handleClearCache=this.handleClearCache.bind(this),this.handleClearRecentServers=this.handleClearRecentServers.bind(this)}componentDidMount(){return r(this,void 0,void 0,(function*(){this.setState({options:yield c.default.getAll(),browserType:yield u.getBrowserType()}),c.default.addEventListener("changed",(()=>r(this,void 0,void 0,(function*(){this.setState({options:yield c.default.getAll()})}))))}))}render(){var e,t,n,o,i,a,r,s;return l.default.createElement("form",{className:"options"},this.state.options&&l.default.createElement(l.default.Fragment,null,l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"autoConnect",type:"checkbox",checked:null===(e=this.state.options)||void 0===e?void 0:e.autoConnect,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsAutoConnectLabel")),l.default.createElement("div",{className:"option__description"},p("optionsAutoConnectDescription")),l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"rememberConnectedServer",type:"checkbox",checked:null===(t=this.state.options)||void 0===t?void 0:t.rememberConnectedServer,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsRememberConnectedServerLabel")),l.default.createElement("div",{className:"option__description"},p("optionsRememberConnectedServerDescription")))),l.default.createElement("hr",null),l.default.createElement("label",{className:"option option--inline proxy-dns-option"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"proxyDns",type:"checkbox",checked:null===(n=this.state.options)||void 0===n?void 0:n.proxyDns,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsProxyDnsLabel")),l.default.createElement("div",{className:"option__description"},p("optionsProxyDnsDescription"))),l.default.createElement("hr",null),l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"enableNotifications",type:"checkbox",checked:null===(o=this.state.options)||void 0===o?void 0:o.enableNotifications,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsEnableNotificationsLabel")),l.default.createElement("div",{className:"option__description"},p("optionsEnableNotificationsDescription")),l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"enableNotificationsOnlyErrors",type:"checkbox",checked:null===(i=this.state.options)||void 0===i?void 0:i.enableNotificationsOnlyErrors,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsEnableNotificationsOnlyErrorsLabel")))),l.default.createElement("hr",null),l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"enableIpv6Lookups",type:"checkbox",checked:null===(a=this.state.options)||void 0===a?void 0:a.enableIpv6Lookups,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsEnableIpv6LookupsLabel")),l.default.createElement("div",{className:"option__description"},p("optionsEnableIpv6LookupsDescription"))),l.default.createElement("hr",null),l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"enableDebugInfo",type:"checkbox",checked:null===(r=this.state.options)||void 0===r?void 0:r.enableDebugInfo,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsEnableDebugInfoLabel")),l.default.createElement("div",{className:"option__description"},p("optionsEnableDebugInfoDescription"))),this.state.browserType===u.BrowserType.Firefox&&l.default.createElement(l.default.Fragment,null,l.default.createElement("hr",null),l.default.createElement("label",{className:"option option--inline"},l.default.createElement("div",{className:"option__control"},l.default.createElement("input",{name:"enableExcludeList",type:"checkbox",checked:null===(s=this.state.options)||void 0===s?void 0:s.enableExcludeList,onChange:this.handleInputChange})),l.default.createElement("div",{className:"option__label"},p("optionsEnableExcludeListLabel")),l.default.createElement("label",{className:"option"},l.default.createElement("div",{className:"option__label"},p("optionsExcludeListLabel")),l.default.createElement("div",{className:"option__description"},p("optionsExcludeListDescription")),l.default.createElement("div",{className:"option__control"},l.default.createElement("textarea",{name:"excludeList",onChange:this.handleExcludeListChange,value:this.state.options.excludeList.join("\n"),rows:8})))))),l.default.createElement("hr",null),l.default.createElement("div",{className:"buttons"},l.default.createElement("button",{onClick:this.handleClearCache},p("optionsClearCacheLabel")),l.default.createElement("button",{onClick:this.handleClearRecentServers},p("optionsClearRecentServersLabel"))))}handleClearCache(){d.default.remove(["serverList","serverListFrom"])}handleClearRecentServers(){d.default.remove(["recentServers"])}handleInputChange(e){this.setState((t=>(t.options&&(t.options[e.target.name]=function(e){switch(e.type){case"checkbox":return e.checked;case"number":return parseFloat(e.value);default:return e.value}}(e.target),this.saveOptions()),t)))}handleExcludeListChange(e){this.setState((t=>(t.options&&(""===e.target.value&&(t.options.excludeList=[]),t.options.excludeList=e.target.value.split("\n"),this.saveOptions()),t)))}saveOptions(){return r(this,void 0,void 0,(function*(){yield c.default.setAll(this.state.options)}))}}t.OptionsView=f},82:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(721));r.getBrowserType().then((e=>{const t=document.createElement("link");switch(t.rel="stylesheet",e){case r.BrowserType.Firefox:t.href=browser.runtime.getURL("ui/options/options-firefox.css");break;case r.BrowserType.Chromium:t.href=browser.runtime.getURL("ui/options/options-chromium.css");break;default:return}document.head.append(t)}))},586:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsPanel=void 0;const s=r(n(776)),l=a(n(291)),c=n(454),u=browser.i18n.getMessage;class d extends s.default.Component{constructor(){super(...arguments),this.panelRef=s.default.createRef()}componentDidMount(){const e=this.panelRef.current;e&&(this.trap=l.createFocusTrap(e,{escapeDeactivates:!1,fallbackFocus:".panel"}))}render(){var e,t;let n="panel";return this.props.open&&(n+=` ${n}--visible`),this.props.open?null===(e=this.trap)||void 0===e||e.activate():null===(t=this.trap)||void 0===t||t.deactivate(),s.default.createElement("div",{className:n,ref:this.panelRef,tabIndex:-1},s.default.createElement("div",{className:"panel__header"},s.default.createElement("h2",{className:"panel__title"},u("optionsPanelTitle")),s.default.createElement("button",{className:"panel__tab-button",onClick:()=>browser.runtime.openOptionsPage()},u("optionsPanelViewInTab")),s.default.createElement("button",{className:"panel__close-button",onClick:()=>this.props.onClose()},u("optionsPanelClose"))),s.default.createElement("div",{className:"panel__content"},s.default.createElement(c.OptionsView,null)))}}t.OptionsPanel=d},325:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=s(n(776)),c=s(n(776)),u=s(n(904)),d=s(n(876)),p=s(n(740)),f=s(n(541)),h=s(n(748)),v=n(721),m=a(n(662)),b=n(586);n(82);const y=browser.i18n.getMessage;let g;browser.runtime.getPlatformInfo().then((e=>{if("mac"===e.os){const e=document.createElement("link");e.rel="stylesheet",e.href="style-mac.css",document.head.append(e)}}));class _ extends l.default.Component{constructor(e){super(e),this.state={isLoading:!0,isUpdating:!1,isOptionsPanelOpen:!1,proxy:{isConnected:!1,isConnecting:!1},recentServers:[]},this.pathOffsets=new Map;const t=new XMLHttpRequest;t.open("GET","assets/world.svg",!1),t.send();const n=document.createElement("div"),o=t.responseXML.querySelector("svg");n.classList.add("svg-wrapper"),n.append(o),document.body.append(n),u.default((()=>{const e=n.getBoundingClientRect();o.getBoundingClientRect();for(const t of o.getElementsByTagName("path")){const n=t.getBoundingClientRect();t.id=t.id.toLowerCase(),this.pathOffsets.set(t.id,[e.x+e.width/2-(n.x+n.width/2),e.y+e.height/2-(n.y+n.height/2)])}})),this.svgWrapper=n,this.svgElement=o,this.handleCountryChange=this.handleCountryChange.bind(this),this.handleServerChange=this.handleServerChange.bind(this),this.handleConnectClick=this.handleConnectClick.bind(this),this.handleDisconnectClick=this.handleDisconnectClick.bind(this),this.onOptionsPanelClose=this.onOptionsPanelClose.bind(this),this.onOptionsPanelOpen=this.onOptionsPanelOpen.bind(this)}focusCountry(e){if(!e||!this.pathOffsets.has(e))return void this.focusCountry("se");const[t,n]=this.pathOffsets.get(e);this.svgElement.style.transform=`translate(${t}px, ${n}px)`,window.matchMedia("(prefers-reduced-motion: reduce)").matches?this.svgElement.style.visibility||(this.svgElement.style.visibility="visible"):this.svgElement.style.transition||u.default((()=>{this.svgElement.style.transition="transform 400ms ease",this.svgElement.style.visibility="visible"}))}componentDidMount(){var e;return r(this,void 0,void 0,(function*(){g=p.default.connect({name:"background"}),g.onMessage.addListener((e=>{"popup:/update"===e.subject&&this.setState((t=>{if(!t.proxy)return t;for(const n in e.data)t.proxy[n]=e.data[n];return t}),(()=>{var e;!(null===(e=this.state.proxy)||void 0===e?void 0:e.isConnecting)&&this.serverMap&&this.updateConnectionDetails()}))}));let{serverList:t,serverListFrom:n}=yield d.default.get(["serverList","serverListFrom"]);(!t||Date.now()-n>v.getMinutesInMs(5))&&(t=yield m.fetchServerList(),n=Date.now(),yield d.default.set({serverList:t,serverListFrom:n}));const o=new Map;for(const n of t){let t=null!==(e=o.get(n.country_code))&&void 0!==e?e:[];n.active&&(t.push(n),t.sort(((e,t)=>{const n=m.getServerIdFromHost(e.hostname),o=m.getServerIdFromHost(t.hostname);return n<o?-1:n>o?1:0})),o.set(n.country_code,t))}const{recentServers:i}=yield d.default.get("recentServers");null==i||i.forEach(((e,t)=>{const n=o.get(e.country_code),a=null==n?void 0:n.find((t=>t.socks_name===e.socks_name));a?i.splice(t,1,a):i.splice(t,1)})),this.serverMap=o,this.setState({recentServers:i,isLoading:!1},(()=>{this.updateConnectionDetails()}))}))}renderConnectionInfo(){var e,t,n,o,i,a,r;let s="connection";return this.state.isLoading&&(s+=" connection--loading"),l.default.createElement("div",{className:s},l.default.createElement("button",{className:"options-button",onClick:this.onOptionsPanelOpen,title:y("optionsPanelOpen")}),this.state.isLoading?l.default.createElement("div",{className:"loader",title:y("popupLoading")}):l.default.createElement(l.default.Fragment,null,l.default.createElement("div",{className:"connection__status "+((null===(e=this.state.proxy)||void 0===e?void 0:e.isConnected)?"connection__status--connected":(null===(t=this.state.proxy)||void 0===t?void 0:t.isConnecting)?"connection__status--connecting":"connection__status--not-connected")},(null===(n=this.state.proxy)||void 0===n?void 0:n.isConnected)?l.default.createElement(l.default.Fragment,null,y("popupConnectionStatusConnected"),l.default.createElement("a",{className:"connection__info",href:m.CHECK_URL,title:this.isViaWireGuard()?y("popupConnectionTypeWireGuard"):y("popupConnectionTypeOpenVPN")})):(null===(o=this.state.proxy)||void 0===o?void 0:o.isConnecting)?l.default.createElement(E,{text:y("popupConnectionStatusConnecting")}):y("popupConnectionStatusNotConnected")),this.state.isUpdating?l.default.createElement("div",{className:"loader",title:y("popupLoading")}):l.default.createElement(l.default.Fragment,null,(null===(i=this.state.connectionDetails)||void 0===i?void 0:i.city)&&l.default.createElement("div",{className:"connection__city"},this.state.connectionDetails.city),l.default.createElement("div",{className:"connection__country"},null===(a=this.state.connectionDetails)||void 0===a?void 0:a.country),l.default.createElement("div",{className:"connection__ip connection__ip--v4",title:y("popupConnectionIpv4Title")},null===(r=this.state.connectionDetails)||void 0===r?void 0:r.ip),this.state.address6&&l.default.createElement("div",{className:"connection__ip connection__ip--v6",title:y("popupConnectionIpv6Title")},this.state.address6))))}renderSelectionUI(){var e,t,n,o;return l.default.createElement("fieldset",{className:"selection",disabled:this.state.isLoading||(null===(e=this.state.proxy)||void 0===e?void 0:e.isConnecting)||!this.serverMap},l.default.createElement("select",{className:`selection__country ${!this.state.selectedCountry&&"selection__country--default"}`,title:y("popupSelectionCountryPlaceholder"),value:this.state.selectedCountry,onChange:this.handleCountryChange},l.default.createElement("option",{selected:!this.state.selectedCountry,disabled:!0},y("popupSelectionCountryPlaceholder")),this.state.recentServers&&l.default.createElement("optgroup",{label:y("popupSelectionCountryRecentServers")},this.state.recentServers.map((e=>l.default.createElement("option",{value:e.socks_name},e.country_name," (",m.getShortSocksName(e.socks_name),")")))),this.serverMap&&Array.from(this.serverMap.entries()).map((([e,t],n)=>l.default.createElement("option",{value:e,key:n},t[0].country_name)))),l.default.createElement("select",{className:`selection__server ${!this.state.selectedServer&&"selection__server--default"}`,title:y("popupSelectionServerPlaceholder"),disabled:!this.state.selectedCountry,value:this.state.selectedServer,onChange:this.handleServerChange},l.default.createElement("option",{selected:!this.state.selectedServer,disabled:!0},y("popupSelectionServerPlaceholder")),this.state.selectedCountry&&(null===(n=null===(t=this.serverMap)||void 0===t?void 0:t.get(this.state.selectedCountry))||void 0===n?void 0:n.map(((e,t)=>l.default.createElement("option",{value:e.socks_name,key:t},m.getShortSocksName(e.socks_name)," ","(",e.city_name,")"))))),l.default.createElement("button",{className:"selection__connect",disabled:!(this.state.selectedServer&&this.state.selectedServer!==(null===(o=this.state.proxy)||void 0===o?void 0:o.host)),onClick:this.handleConnectClick},y("popupSelectionConnect")))}render(){var e,t;const n=(null===(e=this.state.proxy)||void 0===e?void 0:e.isConnected)||(null===(t=this.state.proxy)||void 0===t?void 0:t.isConnecting);return l.default.createElement(l.default.Fragment,null,this.renderConnectionInfo(),this.isViaWireGuard()&&this.renderSelectionUI(),l.default.createElement("fieldset",{className:"control"},!this.state.connectionDetails||this.isViaWireGuard()||n?l.default.createElement("button",{className:"control__disconnect",onClick:this.handleDisconnectClick,disabled:!n},y("popupDisconnect")):l.default.createElement("button",{className:"control__connect",onClick:this.handleConnectClick,disabled:this.state.isLoading},y("popupConnect"))),l.default.createElement(b.OptionsPanel,{open:this.state.isOptionsPanelOpen,onClose:this.onOptionsPanelClose}))}isViaWireGuard(){var e,t;return"wireguard"===(null===(e=this.state.connectionDetails)||void 0===e?void 0:e.mullvad_server_type)||"socks through wireguard"===(null===(t=this.state.connectionDetails)||void 0===t?void 0:t.mullvad_server_type)}updateConnectionDetails(){var e,t,n;return r(this,void 0,void 0,(function*(){if(!this.serverMap)return;let o,i,a;this.setState({isUpdating:!0});try{const e=m.fetchConnectionDetails();(yield h.default.get("enableIpv6Lookups"))?m.fetchIpAddress(m.EndpointVariant.IPv6).then((e=>this.setState({address6:e}))).catch((()=>{this.setState({address6:void 0})})):this.setState({address6:void 0}),o=yield e}catch(e){return f.default.error("Failed to fetch connection details!"),void this.setState({isUpdating:!1})}for(const[,e]of this.serverMap){const t=e.find((e=>{var t,n;return null===(n=null===(t=this.state.proxy)||void 0===t?void 0:t.host)||void 0===n?void 0:n.startsWith(e.socks_name)}));if(t){i=t,a=i.country_code;break}}(!i&&(null===(e=this.state.proxy)||void 0===e?void 0:e.host)===m.SOCKS_ADDRESS||(null===(t=this.state.proxy)||void 0===t?void 0:t.host)===m.SOCKS_ADDRESS_WG)&&(a=null===(n=o.mullvad_exit_ip_hostname)||void 0===n?void 0:n.slice(0,2)),this.setState({selectedCountry:a,selectedServer:null==i?void 0:i.socks_name,connectionDetails:o,isUpdating:!1},(()=>{if(this.state.connectionDetails){const{mullvad_exit_ip_hostname:e}=this.state.connectionDetails;this.focusCountry(null==e?void 0:e.slice(0,2)),g.postMessage({subject:"background:/updateConnectionDetails",data:{details:this.state.connectionDetails}})}}))}))}handleCountryChange(e){if(e.target.value.length>2){const t=this.state.recentServers.find((t=>t.socks_name===e.target.value));if(!t)return;this.setState({selectedCountry:t.country_code,selectedServer:t.socks_name})}else this.setState({selectedCountry:e.target.value,selectedServer:void 0})}handleServerChange(e){this.setState({selectedServer:e.target.value})}handleConnectClick(){var e,t,n;return r(this,void 0,void 0,(function*(){if(this.state.connectionDetails&&(this.isViaWireGuard()?this.state.selectedServer&&g.postMessage({subject:"background:/connect",data:{proxyHost:this.state.selectedServer,details:this.state.connectionDetails}}):g.postMessage({subject:"background:/connect",data:{proxyHost:m.SOCKS_ADDRESS,details:this.state.connectionDetails}}),this.state.selectedCountry)){const o=null!==(e=(yield d.default.get("recentServers")).recentServers)&&void 0!==e?e:[],i=null===(n=null===(t=this.serverMap)||void 0===t?void 0:t.get(this.state.selectedCountry))||void 0===n?void 0:n.find((e=>e.socks_name===this.state.selectedServer));if(i){const e=o.findIndex((e=>e.socks_name===i.socks_name));-1!==e&&o.splice(e,1),o.unshift(i),o.length>3&&o.pop(),yield d.default.set({recentServers:o}),this.setState({recentServers:o})}}}))}handleDisconnectClick(){g.postMessage({subject:"background:/disconnect"})}onOptionsPanelOpen(){this.setState({isOptionsPanelOpen:!0})}onOptionsPanelClose(){this.setState({isOptionsPanelOpen:!1})}}class E extends l.default.Component{constructor(e){var t;super(e),this.state={ellipsis:""},setInterval((()=>{this.setState((e=>({ellipsis:this.getNextEllipsis(e.ellipsis)})))}),null!==(t=this.props.duration)&&void 0!==t?t:500)}render(){return l.default.createElement("div",{className:"loading"},this.props.text,this.state.ellipsis)}getNextEllipsis(e){return""===e?".":"."===e?"..":".."===e?"...":""}}c.default.render(l.default.createElement(_,null),document.body)}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e].call(a.exports,a,a.exports,o),a.exports}o.m=t,e=[],o.O=(t,n,i,a)=>{if(!n){var r=1/0;for(u=0;u<e.length;u++){for(var[n,i,a]=e[u],s=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(s=!1,a<r&&(r=a));if(s){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,i,a]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={104:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[r,s,l]=n,c=0;if(r.some((t=>0!==e[t]))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(l)var u=l(o)}for(t&&t(n);c<r.length;c++)a=r[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=o.O(void 0,[514],(()=>o(325)));i=o.O(i)})();